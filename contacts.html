<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Contacts — Single File</title>
<style>
  :root{
    --bg:#0f172a; --panel:#0b1224; --panel2:#0c162d; --text:#e5e7eb; --muted:#94a3b8;
    --accent:#60a5fa; --ok:#34d399; --warn:#fbbf24; --danger:#f87171; --border:#1f2937;
    --card:#0c1429; --shadow:0 6px 20px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,Segoe UI,Roboto,Ubuntu,Helvetica,Arial;
    color:var(--text); background:linear-gradient(160deg,#0b1022,#0f172a 50%,#0b1224 100%);
  }
  header{
    position:sticky; top:0; z-index:5; backdrop-filter:saturate(1.2) blur(8px);
    background:#0b1022cc; border-bottom:1px solid var(--border);
  }
  .wrap{max-width:1100px; margin:0 auto; padding:16px}
  .title{display:flex; align-items:center; gap:12px; font-size:1.25rem; font-weight:700}
  .title .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 20px var(--accent)}
  .toolbar{
    display:grid; grid-template-columns: 1fr auto auto auto auto; gap:10px; margin-top:12px;
  }
  input[type="search"]{
    width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px;
    background:var(--panel2); color:var(--text); outline:none;
  }
  button, .filelike{
    padding:10px 14px; border:1px solid var(--border); border-radius:12px; background:var(--panel);
    color:var(--text); cursor:pointer; transition:transform .05s ease, background .2s;
  }
  button:hover, .filelike:hover{background:#0e1832}
  button:active{transform:translateY(1px)}
  .ghost{background:transparent}
  .accent{border-color:#264979; background:#0e1f3f}
  .ok{border-color:#1f6f56; background:#0d2d27}
  .danger{border-color:#6b2a2a; background:#2b1212}
  main{max-width:1100px; margin:18px auto; padding:0 16px 80px}
  details.form{
    background:var(--panel); border:1px solid var(--border); border-radius:14px; overflow:hidden; box-shadow:var(--shadow);
  }
  details.form>summary{
    list-style:none; padding:14px 16px; cursor:pointer; user-select:none; font-weight:700;
  }
  details.form>summary::-webkit-details-marker{display:none}
  .form-body{padding:8px 16px 16px; display:grid; gap:12px}
  .grid{
    display:grid; grid-template-columns: repeat(12, 1fr); gap:12px;
  }
  .field{display:flex; flex-direction:column; gap:6px}
  .field label{font-size:.9rem; color:var(--muted)}
  .field input, .field textarea{
    width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:10px;
    background:var(--panel2); color:var(--text); outline:none; min-height:40px;
  }
  .field textarea{min-height:70px; resize:vertical}
  .photo-uploader{
    display:grid; place-items:center; text-align:center; border:1px dashed #2a3a61; border-radius:14px;
    padding:16px; background:#0a1330;
  }
  .photo-uploader input[type=file]{display:none}
  .photo-hint{font-size:.9rem; color:var(--muted)}
  .photo-preview{
    width:120px; height:120px; border-radius:50%; overflow:hidden; background:#071023; border:1px solid var(--border);
    display:grid; place-items:center; margin:6px auto 8px;
  }
  .photo-preview img{width:100%; height:100%; object-fit:cover}
  .cards{
    margin-top:16px;
    display:grid; gap:14px;
    grid-template-columns:repeat(auto-fill, minmax(220px,1fr));
  }
  .card{
    background:var(--card); border:1px solid var(--border); border-radius:16px; padding:14px; box-shadow:var(--shadow);
    display:grid; gap:10px;
  }
  .face{
    width:96px; height:96px; border-radius:50%; overflow:hidden; margin:auto;
    border:2px solid #1d2a4f; box-shadow:0 0 0 4px #0b1224;
  }
  .face img{width:100%; height:100%; object-fit:cover}
  .name{font-weight:800; text-align:center}
  .meta{font-size:.92rem; color:var(--muted); text-align:center}
  .tags{display:flex; flex-wrap:wrap; gap:6px; justify-content:center}
  .tag{font-size:.75rem; color:#cbd5e1; background:#0f1d3c; border:1px solid #1e315f; padding:3px 8px; border-radius:999px}
  .actions{display:flex; gap:8px; justify-content:center; margin-top:8px}
  .actions button{font-size:.9rem; padding:8px 10px}
  .muted{color:var(--muted)}
  .hidden{display:none !important}
  footer{position:fixed; bottom:0; left:0; right:0; border-top:1px solid var(--border); background:#0b1022cc; backdrop-filter:saturate(1.2) blur(8px)}
  footer .wrap{display:flex; justify-content:space-between; align-items:center; gap:8px}
  .counter{font-size:.9rem; color:var(--muted)}
  @media (max-width:720px){
    .toolbar{grid-template-columns:1fr auto auto; grid-auto-rows:auto}
    .toolbar .hide-sm{display:none}
  }
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title"><span class="dot"></span><span>Contacts</span></div>
      <div class="toolbar">
        <input id="search" type="search" placeholder="Search by name, phone, email, notes, or tag…" autocomplete="off" />
        <button id="toggleForm" class="accent">Add Contact</button>
        <label class="filelike ghost hide-sm">
          <input id="importFile" type="file" accept="application/json" hidden>
          Import
        </label>
        <button id="exportBtn" class="ghost hide-sm">Export</button>
        <button id="clearAll" class="danger hide-sm">Clear All</button>
      </div>
    </div>
  </header>

  <main>
    <details id="formPanel" class="form" open>
      <summary>New / Edit Contact</summary>
      <div class="form-body">
        <form id="contactForm">
          <div class="grid">
            <div class="field" style="grid-column: span 6;">
              <label for="name">Full Name *</label>
              <input id="name" required placeholder="Jane Doe"/>
            </div>
            <div class="field" style="grid-column: span 3;">
              <label for="phone">Phone</label>
              <input id="phone" placeholder="+1 (555) 123-4567"/>
            </div>
            <div class="field" style="grid-column: span 3;">
              <label for="email">Email</label>
              <input id="email" type="email" placeholder="jane@example.com"/>
            </div>

            <div class="field" style="grid-column: span 9;">
              <label for="tags">Tags (comma-separated)</label>
              <input id="tags" placeholder="family, work, soccer"/>
            </div>

            <div class="field" style="grid-column: span 3;">
              <label>Photo</label>
              <div class="photo-uploader" id="uploader">
                <div class="photo-preview" id="photoPreview" aria-label="Photo preview">
                  <img id="photoImg" alt="Photo preview" />
                </div>
                <input id="photoFile" type="file" accept="image/*">
                <button type="button" id="choosePhoto" class="ghost">Choose File</button>
                <div class="photo-hint">Drop / Paste an image here</div>
              </div>
            </div>

            <div class="field" style="grid-column: span 12;">
              <label for="notes">Notes</label>
              <textarea id="notes" placeholder="Anything helpful…"></textarea>
            </div>
          </div>

          <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:6px">
            <button type="reset" class="ghost">Reset</button>
            <button type="submit" class="ok" id="saveBtn">Save Contact</button>
          </div>
          <input type="hidden" id="editingId" />
          <input type="hidden" id="photoData" />
        </form>
      </div>
    </details>

    <section class="cards" id="cards"></section>
  </main>

  <footer>
    <div class="wrap">
      <div class="counter" id="countInfo">0 contacts</div>
      <div class="muted">Data is stored locally in your browser.</div>
    </div>
  </footer>

<script>
(function(){
  const LS_KEY = 'contactsApp_v1';

  /** @type {HTMLInputElement} */
  const search = document.getElementById('search');
  const cards = document.getElementById('cards');
  const formPanel = document.getElementById('formPanel');
  const form = document.getElementById('contactForm');
  const saveBtn = document.getElementById('saveBtn');
  const toggleForm = document.getElementById('toggleForm');
  const importFile = document.getElementById('importFile');
  const exportBtn = document.getElementById('exportBtn');
  const clearAll = document.getElementById('clearAll');
  const countInfo = document.getElementById('countInfo');

  const nameEl = document.getElementById('name');
  const phoneEl = document.getElementById('phone');
  const emailEl = document.getElementById('email');
  const tagsEl  = document.getElementById('tags');
  const notesEl = document.getElementById('notes');
  const editingIdEl = document.getElementById('editingId');
  const photoDataEl = document.getElementById('photoData');

  const uploader = document.getElementById('uploader');
  const choosePhoto = document.getElementById('choosePhoto');
  const photoFile = document.getElementById('photoFile');
  const photoImg = document.getElementById('photoImg');

  // Minimal default avatar (SVG data URL)
  const DEFAULT_AVATAR =
    'data:image/svg+xml;utf8,' +
    encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#102047"/><stop offset="1" stop-color="#0b1224"/>
        </linearGradient>
      </defs>
      <rect width="100%" height="100%" fill="url(#g)"/>
      <circle cx="128" cy="108" r="52" fill="#2b3f72"/>
      <rect x="48" y="168" width="160" height="60" rx="30" fill="#22345f"/>
    </svg>`);

  // State
  let all = load();
  let filtered = [...all];

  // Init
  ensureFirstRunSeed();
  render();

  // ——— Events ———
  search.addEventListener('input', () => {
    const q = search.value.trim().toLowerCase();
    filtered = !q ? [...all] : all.filter(c => {
      return [c.name,c.phone,c.email,c.notes,(c.tags||[]).join(' ')].join(' ')
        .toLowerCase().includes(q);
    });
    renderCards();
  });

  toggleForm.addEventListener('click', () => {
    formPanel.open = !formPanel.open;
    if (formPanel.open) nameEl.focus();
  });

  form.addEventListener('reset', (e) => {
    editingIdEl.value = '';
    photoDataEl.value = '';
    photoImg.src = DEFAULT_AVATAR;
    saveBtn.textContent = 'Save Contact';
  });

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const id = editingIdEl.value || crypto.randomUUID();
    const entry = {
      id,
      name: nameEl.value.trim(),
      phone: phoneEl.value.trim(),
      email: emailEl.value.trim(),
      tags: splitTags(tagsEl.value),
      notes: notesEl.value.trim(),
      photo: photoDataEl.value || DEFAULT_AVATAR,
      dt: Date.now()
    };
    if (!entry.name) { alert('Name is required.'); return; }

    const idx = all.findIndex(x => x.id === id);
    if (idx >= 0) { all[idx] = entry; } else { all.unshift(entry); }

    persist(); clearForm(); filterAndRender();
    formPanel.open = false;
  });

  choosePhoto.addEventListener('click', () => photoFile.click());
  photoFile.addEventListener('change', handleImageFiles);
  uploader.addEventListener('dragover', (e)=>{e.preventDefault(); uploader.style.borderColor='#4873c9';});
  uploader.addEventListener('dragleave', ()=>{uploader.style.borderColor='#2a3a61';});
  uploader.addEventListener('drop', (e)=>{e.preventDefault(); uploader.style.borderColor='#2a3a61'; handleImageFiles(e);});
  uploader.addEventListener('paste', (e)=>{
    const items = e.clipboardData && e.clipboardData.items ? e.clipboardData.items : [];
    for (const it of items) {
      if (it.type && it.type.startsWith('image/')) {
        const file = it.getAsFile();
        if (file) { readFileToDataURL(file).then(setPhoto); }
      }
    }
  });

  exportBtn.addEventListener('click', () => {
    const blob = new Blob([JSON.stringify(all,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `contacts_export_${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(a.href);
  });

  importFile.parentElement.addEventListener('click', () => importFile.click());
  importFile.addEventListener('change', async () => {
    const file = importFile.files[0];
    if (!file) return;
    try {
      const text = await file.text();
      const data = JSON.parse(text);
      if (!Array.isArray(data)) throw new Error('Invalid file format.');
      // normalize
      const cleaned = data.map(x => ({
        id: x.id || crypto.randomUUID(),
        name: String(x.name||'').trim(),
        phone: String(x.phone||'').trim(),
        email: String(x.email||'').trim(),
        tags: Array.isArray(x.tags) ? x.tags : splitTags(x.tags || ''),
        notes: String(x.notes||'').trim(),
        photo: x.photo && String(x.photo).startsWith('data:image') ? x.photo : DEFAULT_AVATAR,
        dt: Number(x.dt)||Date.now()
      })).filter(x => x.name);
      all = dedupeById([...cleaned, ...all]);
      persist(); filterAndRender();
      alert('Imported successfully.');
    } catch(err){
      console.error(err); alert('Import failed: ' + err.message);
    } finally {
      importFile.value = '';
    }
  });

  clearAll.addEventListener('click', () => {
    if (!confirm('This will delete ALL contacts stored in this browser. Continue?')) return;
    all = []; persist(); filterAndRender(); clearForm();
  });

  // ——— Helpers ———
  function render(){
    photoImg.src = DEFAULT_AVATAR;
    filterAndRender();
  }
  function filterAndRender(){
    const q = search.value.trim().toLowerCase();
    filtered = !q ? [...all] : all.filter(c => {
      return [c.name,c.phone,c.email,c.notes,(c.tags||[]).join(' ')].join(' ')
        .toLowerCase().includes(q);
    });
    renderCards();
  }
  function renderCards(){
    cards.innerHTML = '';
    if (!filtered.length){
      const empty = document.createElement('div');
      empty.className='muted';
      empty.textContent = 'No contacts yet. Add your first one above!';
      cards.appendChild(empty);
    } else {
      for (const c of filtered){
        cards.appendChild(cardEl(c));
      }
    }
    countInfo.textContent = `${all.length} contact${all.length===1?'':'s'}`;
  }
  function cardEl(c){
    const el = document.createElement('article');
    el.className = 'card';
    el.innerHTML = `
      <div class="face"><img alt="Face of ${esc(c.name)}" src="${c.photo||DEFAULT_AVATAR}"></div>
      <div class="name">${esc(c.name)}</div>
      <div class="meta">
        ${c.phone ? `<div>${esc(c.phone)}</div>`:''}
        ${c.email ? `<div>${esc(c.email)}</div>`:''}
      </div>
      ${c.tags?.length ? `<div class="tags">${c.tags.map(t=>`<span class="tag">${esc(t)}</span>`).join('')}</div>`:''}
      ${c.notes ? `<div class="muted" style="text-align:center">${esc(c.notes)}</div>`:''}
      <div class="actions">
        <button data-act="edit" class="accent">Edit</button>
        <button data-act="delete" class="danger">Delete</button>
      </div>
    `;
    el.querySelector('[data-act="edit"]').addEventListener('click', ()=> startEdit(c.id));
    el.querySelector('[data-act="delete"]').addEventListener('click', ()=> del(c.id));
    return el;
  }
  function startEdit(id){
    const c = all.find(x => x.id === id);
    if (!c) return;
    formPanel.open = true;
    editingIdEl.value = c.id;
    nameEl.value = c.name || '';
    phoneEl.value = c.phone || '';
    emailEl.value = c.email || '';
    tagsEl.value = (c.tags||[]).join(', ');
    notesEl.value = c.notes || '';
    photoDataEl.value = c.photo || '';
    photoImg.src = c.photo || DEFAULT_AVATAR;
    saveBtn.textContent = 'Update Contact';
    nameEl.focus();
  }
  function del(id){
    const c = all.find(x => x.id === id);
    if (!c) return;
    if (!confirm(`Delete ${c.name}?`)) return;
    all = all.filter(x => x.id !== id);
    persist(); filterAndRender();
  }
  function persist(){ localStorage.setItem(LS_KEY, JSON.stringify(all)); }
  function load(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if (!raw) return [];
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) return [];
      return arr.map(x => ({
        id: x.id || crypto.randomUUID(),
        name: String(x.name||'').trim(),
        phone: String(x.phone||'').trim(),
        email: String(x.email||'').trim(),
        tags: Array.isArray(x.tags) ? x.tags : splitTags(x.tags || ''),
        notes: String(x.notes||'').trim(),
        photo: x.photo && String(x.photo).startsWith('data:image') ? x.photo : DEFAULT_AVATAR,
        dt: Number(x.dt)||Date.now()
      }));
    } catch(e){ console.warn('load failed', e); return []; }
  }
  function clearForm(){ form.reset(); photoImg.src = DEFAULT_AVATAR; }
  function splitTags(s){ return String(s||'').split(',').map(t=>t.trim()).filter(Boolean); }
  function esc(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[m])); }
  function readFileToDataURL(file){
    return new Promise((resolve,reject)=>{
      const fr = new FileReader();
      fr.onload = () => resolve(fr.result);
      fr.onerror = reject;
      fr.readAsDataURL(file);
    });
  }
  function handleImageFiles(e){
    const files = e.target?.files || e.dataTransfer?.files || [];
    if (!files.length) return;
    const file = files[0];
    if (!file.type.startsWith('image/')) { alert('Please choose an image.'); return; }
    readFileToDataURL(file).then(setPhoto).catch(err => alert('Failed to read image: '+err.message));
    photoFile.value = '';
  }
  function setPhoto(dataUrl){
    photoDataEl.value = dataUrl;
    photoImg.src = dataUrl;
  }
  function dedupeById(arr){
    const seen=new Set(); const out=[];
    for (const x of arr){ if(seen.has(x.id)) continue; seen.add(x.id); out.push(x); }
    return out.sort((a,b)=>b.dt-a.dt);
  }
  function ensureFirstRunSeed(){
    if (all.length) return;
    // A couple of demo contacts (photos use the default avatar)
    all = [
      { id: crypto.randomUUID(), name:'Ada Lovelace', email:'ada@example.com', phone:'+44 20 0000 0000', tags:['work','vip'], notes:'Computing pioneer.', photo:DEFAULT_AVATAR, dt: Date.now()-2 },
      { id: crypto.randomUUID(), name:'Linus Torvalds', email:'linus@example.com', phone:'+1 555 555 0000', tags:['kernel'], notes:'Ping before calling.', photo:DEFAULT_AVATAR, dt: Date.now()-1 },
    ];
    persist();
  }
})();
</script>
</body>
</html>
