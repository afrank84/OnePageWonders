<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Planner</title>
<style>
  :root{
    /* Print (letter) */
    --page-w: 8.5in;
    --page-h: 11in;

    /* Screen */
    --screen-max-w: 1200px;

    --ink: #222;
    --muted: #6b7280;
    --line: #cfd6e3;
    --accent: #4f46e5;
    --bg: #e9eef5;
    --paper-top: #f4f7fb;
    --paper-bot: #eef2f9;
    --card: #ffffff;
    --card-border: #e5eaf4;
    --shadow: 0 10px 25px rgba(30,41,59,.12);
  }
  /* Dark theme */
  :root[data-theme="dark"]{
    --ink: #e5e7eb;
    --muted: #9aa3b2;
    --line: #2d3648;
    --accent: #8b87f8;
    --bg: #0b0e14;
    --paper-top: #111725;
    --paper-bot: #0c111b;
    --card: #0f1625;
    --card-border: #1f2a3d;
    --shadow: 0 10px 25px rgba(0,0,0,.45);
  }

  *{box-sizing:border-box}
  html,body{min-height:100%}
  body{
    margin:0;
    padding:24px 8px 40px;  /* slimmer left/right, comfy top margin */
    background:var(--bg);
    color:var(--ink);
    font:14px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  }

  .page{
    width:min(96vw, var(--screen-max-w)); /* wider on desktop, minimal waste */
    margin:0 auto;
    background:linear-gradient(var(--paper-top),var(--paper-bot));
    border:1px solid var(--card-border);
    border-radius:10px;
    box-shadow:var(--shadow);
    padding:18px;
  }

  .head{display:flex;justify-content:space-between;align-items:flex-end;gap:8px;margin-bottom:12px;flex-wrap:wrap}
  .title{font-weight:700;letter-spacing:.04em;font-size:22px}
  .date{display:flex;gap:8px;align-items:center;font-size:13px;color:var(--muted)}
  .date input{
    border:none;border-bottom:2px solid var(--line);background:transparent;outline:none;
    padding:2px 4px;min-width:140px;font:inherit;color:var(--ink)
  }

  .grid{
    display:grid;
    grid-template-columns: 1.2fr .8fr;
    gap:18px;
  }
  .col{display:flex;flex-direction:column;gap:12px;min-height:0}

  h3{
    margin:0 0 6px 0;
    font-size:11px;
    font-weight:700;
    letter-spacing:.06em;
    color:var(--muted);
    text-transform:uppercase;
  }

  /* Cards */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:10px;
    padding:10px 12px;
    box-shadow:0 1px 0 rgba(0,0,0,.02);
  }

  /* Schedule */
  .schedule .row{
    display:grid;grid-template-columns: 64px 1fr 16px;align-items:center;gap:8px;
    padding:4px 0;
    border-bottom:1px dashed var(--line);
  }
  .schedule .row:last-child{border-bottom:none}
  .time{color:var(--muted);font-size:12px;white-space:nowrap}
  .note-bullet{width:10px;height:10px;border:1px solid var(--line);border-radius:50%}

  /* Editable schedule slot (no placeholder) */
  .slot{
    height:22px;
    border-bottom:1px solid var(--line);
    margin-top:-10px;
    outline:none;
    white-space:nowrap;
    overflow:hidden;
  }

  /* 2-column schedule option */
  #schedule.two-col{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:6px 12px;
  }

  /* Scrollable schedule option (applies to the card) */
  .schedule.scroll #schedule{
    max-height:clamp(360px, 60vh, 740px);
    overflow:auto;
    padding-right:4px;
  }

  /* Lists */
  .checkline{
    display:grid;grid-template-columns:18px 1fr;gap:8px;align-items:center;
    padding:5px 0;border-bottom:1px dashed var(--line);
  }
  .checkline:last-child{border-bottom:none}
  input[type="checkbox"]{
    width:14px;height:14px;border:1px solid var(--line);border-radius:3px;appearance:none;
    display:inline-grid;place-content:center;cursor:pointer;background:var(--card);
  }
  input[type="checkbox"]:checked{background:var(--accent);border-color:var(--accent)}
  input[type="checkbox"]:checked::after{content:"✓";font-size:12px;color:white;line-height:1}

  /* Type-on lines */
  .write-line{
    height:22px;border-bottom:1px solid var(--line);
  }
  .write-line[contenteditable="true"]{outline:none;white-space:nowrap;overflow:hidden}
  .write-line[contenteditable="true"]:empty::before{content:"Type here";color:#98a2b3}

  .freewrite{
    min-height:90px;border:1px dashed var(--line);border-radius:8px;padding:8px;background:var(--card)
  }

  /* Controls (hidden on print) */
  .controls{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px}
  .btn{
    background:var(--card);border:1px solid var(--card-border);border-radius:10px;padding:8px 12px;cursor:pointer;
    font-size:13px;color:var(--ink)
  }
  .btn:hover{border-color:#bcc7e6}
  #fileInput{display:none}

  /* Responsive */
  @media (max-width: 1024px){
    .grid{grid-template-columns: 1fr}
    .title{font-size:20px}
  }

  @media print{
    :root{
      --ink:#111; --muted:#444; --line:#cfd6e3; --bg:#fff; --paper-top:#fff; --paper-bot:#fff;
      --card:#fff; --card-border:#e5eaf4; --shadow:none;
    }
    body{background:#fff;padding:0}
    .page{box-shadow:none;border:none;width:var(--page-w);height:var(--page-h);margin:0;padding:0}
    .controls{display:none}
    .write-line[contenteditable="true"]:empty::before{content:""}
    .schedule #schedule{max-height:none;overflow:visible}
  }
</style>
</head>
<body>
  <div class="page">
    <div class="controls">
      <button class="btn" onclick="window.print()">Print / Save as PDF</button>
      <button class="btn" id="clearAll">Clear checks</button>
      <button class="btn" id="toggleCols">2-Col Schedule</button>
      <button class="btn" id="toggleScroll">Scroll Schedule</button>
      <button class="btn" id="themeToggle">Dark/Light</button>
      <button class="btn" id="exportJson">Export JSON</button>
      <button class="btn" id="importJson">Import JSON</button>
      <input type="file" id="fileInput" accept="application/json,.json">
    </div>

    <div class="head">
      <div class="title">DAILY PLAN</div>
      <div class="date">DATE: <input id="dateField" type="date"></div>
    </div>

    <div class="grid">
      <!-- LEFT: Schedule -->
      <div class="col">
        <div class="card schedule" id="scheduleCard">
          <h3>Schedule</h3>
          <div id="schedule"></div>
        </div>
      </div>

      <!-- RIGHT: Priorities / Lists / Notes -->
      <div class="col">
        <div class="card" id="workTop3">
          <h3>Top 3 Work Priorities</h3>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true" aria-label="Work priority 1"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true" aria-label="Work priority 2"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true" aria-label="Work priority 3"></div></div>
        </div>

        <div class="card" id="workList">
          <h3>Work To-Do List</h3>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
        </div>

        <div class="card" id="personalTop3">
          <h3>Top 3 Personal Priorities</h3>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
        </div>

        <div class="card" id="personalList">
          <h3>Personal To-Do List</h3>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
          <div class="checkline"><input type="checkbox"><div class="write-line" contenteditable="true"></div></div>
        </div>

        <div class="card">
          <h3>Notes</h3>
          <div id="notesArea" class="freewrite" contenteditable="true" aria-label="Notes area"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ---------- Utils ----------
  const $ = (s, root=document) => root.querySelector(s);
  const $$ = (s, root=document) => Array.from(root.querySelectorAll(s));
  const root = document.documentElement;
  const stateKeyFor = (date) => `planner/day/${date}`;

  // Debounce helper
  const debounce = (fn, ms=300) => {
    let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); };
  };

  // ---------- Theme ----------
  function applyTheme(mode){
    if(mode === 'dark'){ root.setAttribute('data-theme','dark'); }
    else if(mode === 'light'){ root.setAttribute('data-theme','light'); }
    else {
      root.setAttribute('data-theme',
        (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light'
      );
    }
  }
  applyTheme(localStorage.getItem('planner-theme') || 'auto');

  $('#themeToggle').addEventListener('click', ()=>{
    const current = root.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    applyTheme(next);
    localStorage.setItem('planner-theme', next);
    saveState(); // persist chosen theme with the day too
  });

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', ()=>{
    if(!localStorage.getItem('planner-theme')) applyTheme('auto');
  });

  // ---------- Date ----------
  (()=>{ $('#dateField').value = new Date().toISOString().slice(0,10); })();

  // ---------- Schedule builder (6:00 AM – 10:30 PM, 30-min) ----------
  (()=> {
    const start = 6 * 60, end = 22 * 60 + 30;
    const wrap = $('#schedule');
    for(let m = start; m <= end; m += 30){
      const h = Math.floor(m/60), mm = m%60;
      const ampm = h < 12 ? 'am' : 'pm';
      const hh = ((h+11)%12)+1;
      const label = `${hh}:${mm.toString().padStart(2,'0')} ${ampm}`;

      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = `
        <div class="time">${label}</div>
        <div class="slot" contenteditable="true" data-time="${m}"></div>
        <div class="note-bullet" aria-hidden="true"></div>
      `;
      wrap.appendChild(row);
    }
  })();

  // ---------- Collect & Apply State ----------
  function readList(containerId){
    return $$('#'+containerId+' .checkline').map(line=>{
      const cb = $('input[type="checkbox"]', line);
      const txt = $('.write-line', line);
      return { checked: !!cb.checked, text: (txt.innerText || '').trim() };
    });
  }
  function populateList(containerId, arr){
    const lines = $$('#'+containerId+' .checkline');
    for(let i=0;i<lines.length;i++){
      const cb = $('input[type="checkbox"]', lines[i]);
      const txt = $('.write-line', lines[i]);
      const item = arr && arr[i] ? arr[i] : {};
      cb.checked = !!item.checked;
      txt.innerText = item.text || '';
    }
  }

  function getState(){
    const scheduleData = $$('#schedule .slot')
      .map(el => ({ m: +el.dataset.time || null, text: (el.innerText || '').trim() }));
    return {
      version: 4,
      date: $('#dateField').value,
      theme: root.getAttribute('data-theme'),
      scheduleLayout: {
        twoCol: $('#schedule').classList.contains('two-col'),
        scroll: $('#scheduleCard').classList.contains('scroll')
      },
      schedule: scheduleData,
      sections: {
        workTop3: readList('workTop3'),
        workList: readList('workList'),
        personalTop3: readList('personalTop3'),
        personalList: readList('personalList')
      },
      notesHtml: $('#notesArea').innerHTML
    };
  }

  function applyState(data){
    if(!data) return;
    if(data.theme){ applyTheme(data.theme); }
    if(data.scheduleLayout){
      $('#schedule').classList.toggle('two-col', !!data.scheduleLayout.twoCol);
      $('#scheduleCard').classList.toggle('scroll', !!data.scheduleLayout.scroll);
    }
    if(Array.isArray(data.schedule)){
      data.schedule.forEach(({ m, text }) => {
        const el = (m != null) ? document.querySelector(`#schedule .slot[data-time="${m}"]`) : null;
        if (el) el.innerText = text || '';
      });
    }
    if(data.sections){
      populateList('workTop3', data.sections.workTop3);
      populateList('workList', data.sections.workList);
      populateList('personalTop3', data.sections.personalTop3);
      populateList('personalList', data.sections.personalList);
    }
    if(typeof data.notesHtml === 'string') $('#notesArea').innerHTML = data.notesHtml;
  }

  function clearDayUI(){
    // Uncheck and clear text fields for a fresh day
    $$('#schedule .slot').forEach(el => el.innerText = '');
    ['workTop3','workList','personalTop3','personalList'].forEach(id=>{
      $$('#'+id+' .checkline').forEach(line=>{
        $('input[type="checkbox"]', line).checked = false;
        $('.write-line', line).innerText = '';
      });
    });
    $('#notesArea').innerHTML = '';
    $('#schedule').classList.remove('two-col');
    $('#scheduleCard').classList.remove('scroll');
  }

  // ---------- Persistence ----------
  const saveState = debounce(()=>{
    try{
      const k = stateKeyFor($('#dateField').value);
      localStorage.setItem(k, JSON.stringify(getState()));
    }catch(e){ console.warn('Save failed:', e); }
  }, 250);

  function loadStateForDate(dateStr){
    try{
      const k = stateKeyFor(dateStr);
      const raw = localStorage.getItem(k);
      if(raw){
        clearDayUI();
        applyState(JSON.parse(raw));
        return true;
      }
    }catch(e){ console.warn('Load failed:', e); }
    return false;
  }

  // Initial load: try to restore today's state
  loadStateForDate($('#dateField').value);

  // When date changes, load that day's saved state (or start fresh)
  $('#dateField').addEventListener('change', ()=>{
    const ok = loadStateForDate($('#dateField').value);
    if(!ok){ clearDayUI(); saveState(); }
  });

  // Save on interactions
  document.addEventListener('input', (e)=>{
    if(
      e.target.matches('.write-line[contenteditable="true"]') ||
      e.target.matches('.slot[contenteditable="true"]') ||
      e.target.id === 'notesArea'
    ){ saveState(); }
  });
  document.addEventListener('change', (e)=>{
    if(e.target.matches('input[type="checkbox"]')) saveState();
  });

  // ---------- Controls ----------
  // Clear all checkboxes (then save)
  $('#clearAll').addEventListener('click', ()=>{
    $$('input[type="checkbox"]').forEach(c=>c.checked=false);
    saveState();
  });

  // Toggle 2-column schedule
  $('#toggleCols').addEventListener('click', ()=>{
    $('#schedule').classList.toggle('two-col');
    saveState();
  });

  // Toggle scrollable schedule
  $('#toggleScroll').addEventListener('click', ()=>{
    $('#scheduleCard').classList.toggle('scroll');
    saveState();
  });

  // ---------- JSON Import/Export ----------
  function exportJSON(){
    const data = getState();
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    const fname = `daily-plan-${data.date || new Date().toISOString().slice(0,10)}.json`;
    a.href = URL.createObjectURL(blob);
    a.download = fname;
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
  }

  function importJSONFile(file){
    const reader = new FileReader();
    reader.onload = (e)=>{
      try{
        const data = JSON.parse(e.target.result);
        if(data.date) $('#dateField').value = data.date; // switch to that day
        clearDayUI();
        applyState(data);
        // Persist imported state to localStorage for that date
        localStorage.setItem(stateKeyFor($('#dateField').value), JSON.stringify(getState()));
        alert('Plan loaded successfully.');
      }catch(err){
        console.error(err);
        alert('Invalid JSON file.');
      }
    };
    reader.readAsText(file);
  }

  $('#exportJson').addEventListener('click', exportJSON);
  $('#importJson').addEventListener('click', ()=> $('#fileInput').click());
  $('#fileInput').addEventListener('change', (e)=>{
    const file = e.target.files && e.target.files[0];
    if(file) importJSONFile(file);
    e.target.value = ''; // allow re-choosing same file later
  });

  // Keep single-line behavior in contenteditable (no newlines)
  document.addEventListener('keydown', (e)=>{
    if(
      (e.target.matches('.write-line[contenteditable="true"]') || e.target.matches('.slot[contenteditable="true"]')) &&
      e.key === 'Enter'
    ){
      e.preventDefault();
      e.target.blur();
    }
  });
</script>
</body>
</html>
